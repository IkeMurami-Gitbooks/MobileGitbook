# Disabled security features in binary libraries

Норм статья про это для iOS: [https://sensepost.com/blog/2021/on-ios-binary-protections/](https://sensepost.com/blog/2021/on-ios-binary-protections/)

ASLR — Защитная техника, которая помогает защититься от эксплуатации целого ряда разных уязвимостей. Ее активация приводит к рандомизации адресов загрузки различных компонентов программы. `-fPIC` — для рандомизации адресов shared-библиотек, `-fPIE` — для рандомизации адреса загрузки исполняемого модуля.

NX-бит (`noexecstack`) — защита от эксплуатации переполнения буфера на стеке

Активация CFI (`-flto`, `-fvisibility=hidden`, `-fsanitize=cfi`) — защита от Use after free и Type confusion уязвимостей.

`-z relro`, `-z now` — защита от техники эксплутации GOT Overwrite (активация read only allocations не позволит без креша [перезаписать](https://systemoverlord.com/2017/03/19/got-and-plt-for-pwning.html) GOT и PLT)

Пример описания для отчета:

```
CVSS https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N

**Описание:** 

Специалистами Исполнителя при помощи средств автоматизированного тестирования были обнаружены библиотеки, перечисленные в @tbl:libraries, собранные без поддержки рекомендуемых механизмов безопасности ([True]{.low} — механизм поддерживается библиотекой, [False]{.high} — не поддерживается). Этот факт может упростить дальнейшую эксплуатацию определенных бинарных уязвимостей.

| Shared Object | PIE | STACK CANARY | RELPO |
| -------- | -------- | -------- | -------- |
| lib/arm64-v8a/libopencv_imgproc.so  | [False]{.high} | [False]{.high} | [False]{.high} |
| lib/arm64-v8a/libopencv_core.so | [False]{.high} | [False]{.high} | [False]{.high} |
| lib/arm64-v8a/libcardioRecognizer_tegra2.so | [False]{.high} | [True]{.low} | [False]{.high} |
| lib/arm64-v8a/libcardioDecider.so | [False]{.high} | [True]{.low} | [False]{.high} |

: Библиотеки, используемые Android-клиентом {#tbl:libraries}

PIE — библиотека собрана без флага `-fPIC`, в результате чего при исполнении кода этой библиотеки не используется техника ASLR.

STACK CANARY — библиотека собрана без флага `-fstack-protector-all`, в результате чего при исполнении кода этих библиотеки не используются техники защиты от переполнения стека.

RELPO — библиотека собрана без поддержки механизма RELRO, который защищает структуры исполняемого ELF-файла (изменение которых позволяет взломщику изменить ход выполнения программы) путем модификации секций PLT (Procedure Linking Table) или GOT (Global Offset Table) ELF-файла.

FORTIFY — без флага `-D_FORTIFY_SOURCE=2` в результате чего в библиотеке не встроены функции проверки вызова небезопасных функций библиотеки `glibc`.



**Рекомендации по устранению:**

Использовать версии библиотек, собранные с указанием флагов `-fPIC`, `-fstack-protector-all`, `-z,relro,-z,now` и `-D_FORTIFY_SOURCE=2`.
```
