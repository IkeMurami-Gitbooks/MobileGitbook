# Запись трафика Android

## В чем сложность

На Android нет механизма сделать пользовательские сертификаты доверенными. Доверие к ним определяет каждое приложение в отдельности (через `network-security-policy`).

## HTTPs

### Вариант 1

Добавить сертификат в системные сертификаты: перевести сертификат в особый вид и закинуть в особое место

### Вариант 2

1. Установить сертификат в пользовательские (так устанавливаются по-умолчанию)
2. Перепатчить network-security-config в приложении ([пример](https://github.com/rsajob/docs/wiki/%D0%9C%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-https-%D1%82%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%B0-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-Charles-Fiddler-proxy-%D0%B4%D0%BB%D1%8F-Android-%D0%B8-iOS) вручную или через `apk-mitm`)

#### apk-mitm

JS-программа, которая перепатчивает апк, в том числе и для обхода пиннинга и доверия пользовательским сертификатам [https://github.com/shroudedcode/apk-mitm#apk-mitm](https://github.com/shroudedcode/apk-mitm#apk-mitm)

## Записать весь трафик

tcpdump for android (for arm/x86 - единый бинарь) [https://www.androidtcpdump.com/](https://www.androidtcpdump.com)

Запуск: `tcpdump -i any -n -w traffic.pcap 2>/dev/null &`

## Papers And Cases

{% embed url="https://habr.com/post/307774/" %}

норм статья про поиски мест где на стороне библиотек системных происходит ssl pinning: [https://xakep.ru/2019/09/12/ssl-sniffing/](https://xakep.ru/2019/09/12/ssl-sniffing/)

Android SSL Pinning via frida/objection\
[https://vavkamil.cz/2019/09/15/how-to-bypass-android-certificate-pinning-and-intercept-ssl-traffic/](https://vavkamil.cz/2019/09/15/how-to-bypass-android-certificate-pinning-and-intercept-ssl-traffic/)

Cordova: [http://ivancevich.me/articles/ignoring-invalid-ssl-certificates-on-cordova-android-ios/](http://ivancevich.me/articles/ignoring-invalid-ssl-certificates-on-cordova-android-ios/)
